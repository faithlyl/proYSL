$(function(){});
$(function(){plp.init();$(".event-quickbuy").live("tap",function(){var a=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("code");if(isNullOrEmpty(a)){a=$(this).attr("data-code")}var k=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("id");if(isNullOrEmpty(k)){k=$(this).attr("data-id")}var c=$("#allKeyWords").val();var d=$(".breadcrumb").find("li:last").find("a").html();var l=$(this).parents(".thumbnail").find(".goods-introudce a").html();var i=d;if(c!=""){i="Search Result";var j=$("#"+k).val();var m=j.substring(1,j.length-1).split(",");var e="";$.each(m,function(n,o){e=e+o.substring(o.indexOf("=")+1,o.length)+"/"});e=e.substring(0,e.length-1);d=e}else{$(".list-inline li").each(function(){var n=$(this).find("a").html();if((n=="按产品分类"||n=="按功能分类"||n=="按系列分类")){if($(this).index()+1==$(".list-inline li").length){i=n;var o=$(".list-inline li")[1];d=$(o).find("a").html()}else{if($(this).index()+1<$(".list-inline li").length){i=n}}}})}var g=$(this).attr("data-size");var b=$.trim($(this).parents(".thumbnail").find(".row").find(".goods-price span").html());b=b.substring(1,b.length);var h=$(this).parents(".plp-slide").index()-1;try{goToCheckout(a,l,i,d,g,h,b,"1","1","")}catch(f){console.log("tracking code goToCheckout is error")}immediatelyBuy(a)});$(".mobileQuickBuy").live("tap",function(){var a=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("code");if(isNullOrEmpty(a)){a=$(this).attr("data-code")}var k=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("id");if(isNullOrEmpty(k)){k=$(this).attr("data-id")}var c=$("#allKeyWords").val();var d=$(".breadcrumb").find("li:last").find("a").html();var l=$(this).parents(".thumbnail").find(".goods-introudce a").html();var i=d;if(c!=""){i="Search Result";var j=$("#"+k).val();var m=j.substring(1,j.length-1).split(",");var e="";$.each(m,function(n,o){e=e+o.substring(o.indexOf("=")+1,o.length)+"/"});e=e.substring(0,e.length-1);d=e}else{$(".list-inline li").each(function(){var n=$(this).find("a").html();if((n=="按产品分类"||n=="按功能分类"||n=="按系列分类")){if($(this).index()+1==$(".list-inline li").length){i=n;var o=$(".list-inline li")[1];d=$(o).find("a").html()}else{if($(this).index()+1<$(".list-inline li").length){i=n}}}})}var g=$(this).attr("data-size");var b=$.trim($(this).parents(".thumbnail").find(".row").find(".goods-price span").html());b=b.substring(1,b.length);var h=$(this).parents(".plp-slide").index()-1;try{goToCheckout(a,l,i,d,g,h,b,"1","1","")}catch(f){console.log("tracking code goToCheckout is error")}window.location.href="/item/"+a});$(".e-read-more").live("tap",function(){var a=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("code");if(isNullOrEmpty(a)){a=$(this).attr("data-code")}var k=$(this).parents(".thumbnail").find(".swiper-wrapper").find("span.is-active").data("id");if(isNullOrEmpty(k)){k=$(this).attr("data-id")}var c=$("#allKeyWords").val();var d=$(".breadcrumb").find("li:last").find("a").html();var l=$(this).parents(".thumbnail").find(".goods-introudce a").html();var i=d;if(c!=""){i="Search Result";var j=$("#"+k).val();var m=j.substring(1,j.length-1).split(",");var e="";$.each(m,function(n,o){e=e+o.substring(o.indexOf("=")+1,o.length)+"/"});e=e.substring(0,e.length-1);d=e}else{$(".list-inline li").each(function(){var n=$(this).find("a").html();if((n=="按产品分类"||n=="按功能分类"||n=="按系列分类")){if($(this).index()+1==$(".list-inline li").length){i=n;var o=$(".list-inline li")[1];d=$(o).find("a").html()}else{if($(this).index()+1<$(".list-inline li").length){i=n}}}})}var g=$(this).attr("data-size");var b=$.trim($(this).parents(".thumbnail").find(".row").find(".goods-price span").html());b=b.substring(1,b.length);var h=$(this).parents(".plp-slide").index()-1;try{goToPdp(a,l,i,d,g,h,b)}catch(f){console.log("tracking code goToPdp is error")}window.location.href="/item/"+a})});var clearAll=false;var screenSelect=false;var isSearch=false;var _w=$.spice.getWindowWidth();var plp={init:function(){plp.utils.listFilterOpen();plp.utils.initClearActive();plp.utils.colorInit();plp.bind()},requestUrl:{plpFilterAjax:base+"/plp/list.json"},bind:function(){setTimeout(function(){$.spice.lazyLoad("img[lazySrc]",{attr:"lazySrc"})},280);$.spice.tinyscrollbar(".events-tinyscrollbar-plpfilter",{wheelLock:false,touchLock:false,callBack:function(t){}});var b=$.spice.getWindowWidth()>1024,l,m=$(".filtername"),e=$(".events-checked li"),a=$(".events-reset-all"),g=$(".events-confirm"),i=$(".events-mob-screen"),j=$(".events-backlist");l=new IScroll(".events-filter-scroll",{mouseWheel:true,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT|A|DIV|SPAN|IMG|P|I|LABEL)$/}});$(".events-filter-scroll").on("touchmove",function(t){t.preventDefault()});$(window).on("resize.leftNav",function(){if($.spice.getWindowWidth()<1024){l.refresh()}}).trigger("resize.leftNav");i.on("tap",function(){$(".list-left-nav").addClass("is-active");$("html,body").addClass("overflow-hidden")});j.on("tap",function(){$(".list-left-nav.is-active").removeClass("is-active");$("html,body").removeClass("overflow-hidden")});m.on("tap",function(){var t=$(this);t.siblings(".filter-content").stop(true).slideToggle(300,function(){t.parent(".filter-wrapper").toggleClass("is-open");l.refresh()})});if($.spice.getWindowWidth()<1024){a.on("tap",function(){$(".filter-wrapper ul li").removeClass("is-active").find("i").removeClass("is-active");clearAll=true;var u=parseInt($("#mobilMin").val());var t=parseInt($("#mobilMax").val());plp.utils.priceInit(u,t);$(".price-slider").data("spice.slider").setValue([u,t])});g.on("tap",function(){$(".list-left-nav.is-active").removeClass("is-active");$("html,body").removeClass("overflow-hidden");if(clearAll){var t=window.location.pathname;if(t.substring(0,7)=="/search"){window.location.href=t+"?keyword="+$("#allKeyWords").val()}else{window.location.href=t}}$("#pageNo").val(1);plp.clickFilter();return false})}e.off().on("tap",function(){var u=$(this);u.toggleClass("is-active");if(!u.hasClass("is-active")){screenSelect=true}$("#propertySelect").val(true);if(_w>1024){$("#pageNo").val(1);plp.clickFilter()}try{if(u.data("grouptitle")=="规格"){plpFilter("","",u.data("title"))}else{if(u.data("grouptitle")=="色彩"){plpFilter("",u.data("title"),"")}}}catch(t){console.log("tracking code plpFilter is error")}});var h=parseInt($("#allMin").val());var k=parseInt($("#allMax").val());var q=parseInt($("#screenMin").val());var r=parseInt($("#screenMax").val());if(isNaN(q)){q=h}if(isNaN(r)){r=k}var f=$("#propertySelect").val();if(f=="true"){h=parseInt($("#screenState").val());k=parseInt($("#screenEnd").val());$("#allMin").val(h);$("#allMax").val(k);q=parseInt($("#screenState").val());r=parseInt($("#screenEnd").val());$("#propertySelect").val(false)}plp.utils.priceInit(h,k);$(".price-slider").data("spice.slider").setValue([q,r]);$(".price-slider").on("slideStop",function(v){var u=v.value;$(".price-slider").parent().parent().attr("data-min",u[0]);$(".price-slider").parent().parent().attr("data-max",u[1]);$(".price-slider").parent().parent().addClass("is-active");if(_w>1024){$("#pageNo").val(1);plp.clickFilter()}$("#allMin").val(h);$("#allMax").val(k);try{plpFilter(h+"-"+k,"","")}catch(t){console.log("tracking code plpFilter is error")}});$.spice.dropdown(".e-dropdown",{showElemTapCallBack:function(t,u){t.addClass("is-active").siblings().removeClass("is-active");$(u.opt.dropElem,u.elem).find(".dropdown-text").html(t.find(".txt").text());$("#sortStr").val(t.find(".txt").parent("a").attr("sortstr"));$("#pageNo").val(1);plp.clickFilter();$(".dropdown-text").html(t.find(".txt").text())},tinyscrollbarConfig:{wheelLock:true,touchLock:false},showCallBack:function(t){},hideCallBack:function(t){},tinyscrollbarCallBack:function(t,u){}});$(document).on("tap",".e-dropdown .sub-menu li",function(t){t.stopPropagation()});var d=$(".footer").height();$(window).on("scroll.moreLoading",function(){var v=parseFloat($(window).height())+parseFloat($(window).scrollTop());var x=parseFloat($(document).height());var t=Number($("#pageNo").val()),w=Number($("#totalPages").val()),u=undefined;if(t<=w){u=t+1;if(u>w){$(".lazyload-img").addClass("none");return}}if(x-v<=d){$(".lazyload-img").removeClass("none");$("#pageNo").val(u);plp.clickFilter(u,plp.loadType.append)}}).trigger("scroll.moreLoading");$(".events-clear-all").on("tap",function(){$(".filter-wrapper ul li").removeClass("is-active").find("i").removeClass("is-active");$("#pageNo").val(1);$("#propertySelect").val(true);clearAll=true;plp.clickFilter()});var s=$.spice.debounce(function(){var t=$(".list-product .plp-slide:first"),u=$(".img-box img",t),w=u.attr("lazySrc")||u.attr("src"),v=new Image();v.src=w;v.onload=function(){setTimeout(function(){u.attr("src",w);$(".list-product .plp-slide.banner-height").height(t.outerHeight())})}},300);$(window).on("resize.plp",function(){s()}).trigger("resize.plp");var c=$("#pageFlag").val();if(c=="search"){var o=$("#itemCount").val();var p=$("#allKeyWords").val();$(".select-num").html(o+'个结果 "'+p+'"');$(".select-num-mob").html(o+'个结果 "'+p+'"')}var n;clearTimeout(n);n=setTimeout(function(){if($("#sortStr").val()){var t=$(".e-dropdown").find("a[sortstr='"+$("#sortStr").val()+"']").parent().attr("data-txt");$(".e-dropdown").find("a[sortstr='"+$("#sortStr").val()+"']").parent().addClass("is-active");$(".product-select .dropdown-text").html(t)}},300)},clickFilter:function(a,c){var b={};b=plp.getSelectedFilterJSON(null);if(!isNullOrEmpty(a)){b.pn=a}plp.ajaxLoadPLP(b,c)},getSelectedFilterJSON:function(c){var i={filterSelector:$(".filter-main li.is-active"),nidSelector:$("#nid"),keywordSelector:$("#allKeyWords"),pType:"p",cType:"c",rType:"r",filterTypeAttr:"data-type",pValueAttr:"pid-pvid",rValueAttr:"priceRange",sort:$("#sortStr").val(),};var p=$.extend({},i,c);var l=new Array();var g=new Array();var h=new Array();var k=new Array();var v=new Array();var j=new Array();var m=null;var r=null;var a=null;p.filterSelector.each(function(x,z){var y=$(this).attr(p.filterTypeAttr);if(undefined===y){return true}y=y.charAt(0);if(y==p.pType){l.push($(this).attr(p.pValueAttr));var A=y+$(this).attr(p.pValueAttr).split("-")[0];j.push(A);v.push($(this).attr("data-title"))}else{if(y==p.cType){var w=$(this).attr(p.pValueAttr);g.push(w);var B=y+w.split("-")[0];j.push(B);k.push($(this).attr("data-title"))}else{if(y==p.rType){m=$(this).attr("data-min"),r=$(this).attr("data-max");j.push(y)}}}});if(!isNullOrEmpty(m)&&!isNullOrEmpty(r)){h.push(m);h.push(r)}var b=l.join(",");var f=g.join(",");var u=h.join("-");var e=k.join("-");var n=v.join("-");var d=j.join(",");var a=p.keywordSelector.val();var s=6;if(_w>1024){var s=8}var q=$("#pageNo").val();if(clearAll){u="";clearAll=false}if(screenSelect){u="";screenSelect=false}var o={ni:p.nidSelector.val(),pf:b,cf:f,pr:u,s:p.sort,keyword:a,fo:d,pn:q,pageSize:s,c:e,p:n};for(name in o){var t=o[name];if(t==undefined||t==""){delete o[name]}}return o},ajaxLoad:"pushState" in history,ajaxLoadPLP:function(p,o){var f="";var d=window.location.search;var k=false;var g={json:p};var i=$.param(g.json);var a=window.location.pathname;var a=a+"?"+i;if(a.substring(0,7)=="/search"){isSearch=true}if(d==i){return}var c=true;if(!plp.ajaxLoad){window.location.href=a}else{if(k){window.location.href=a}else{history.pushState(p,null,a);var b=plp.utils.syncAjaxLoadItem(g);if(!isNullOrEmpty(b)){if(o==plp.loadType.append){var m=$(b).find(".plp-slide");$(".goods-tab-item").append(m);plp.utils.colorInit();c=false;try{plpItemImpressionTrackingCode(m)}catch(n){console.log("ga tracking plp item impression 动态加载 error.")}}else{$(".list-content-all").html(b)}}else{if(isSearch){window.location.href="/searchEmpty"}c=false;if(!isNullOrEmpty(g.json.pr)){var l=g.json.pr.split("-");var j=parseInt(l[0]);var h=parseInt(l[1]);$(".price-slider").data("spice.slider").setValue([j,h])}}}}if(c){plp.init()}else{$.spice.lazyLoad("img[lazySrc]",{attr:"lazySrc"})}},utils:{syncAjaxLoadItem:function(a){var c={url:plp.requestUrl.plpFilterAjax,json:{}};var b=$.extend({},c,a);return loxia.syncXhrGet(b.url,b.json)},listFilterOpen:function(){$(".filter-wrapper ul li").each(function(a,b){if($(this).hasClass("is-active")){if(!$(this).parent().parent().hasClass("is-open")){$(this).parent().parent().parent().addClass("is-open")}}})},initClearActive:function(){if($(".filter-wrapper ul li.is-active").length>0){$(".clear-all-boxs").removeClass("none")}else{if($(".filter-wrapper ul li.is-active").length==0){$(".clear-all-boxs").addClass("none")}}},colorInit:function(){var a=$(".e-swiper-color");a.each(function(d,e){var c=$(e).data("spice.swiper");if(!c){var b=$(e).siblings(".swiper-button-prev"),f=$(e).siblings(".swiper-button-next");c=new Swiper(e,{speed:400,touchRatio:0,slidesPerView:5,spaceBetween:0,nested:true,prevButton:b[0],nextButton:f[0],breakpoints:{1320:{slidesPerView:4,},1024:{slidesPerView:8,},767:{slidesPerView:5,},375:{slidesPerView:4,}},onInit:function(g){$("span",g.slides).off().on("tap",function(){$("span",g.slides).removeClass("is-active");$(this).addClass("is-active");$(this).closest(".thumbnail").find(".img-box > a img").attr("src",$(this).data("img-src"));var j=$(this).attr("data-code");var k=$(this).attr("data-saleprice");var o=$(this).attr("data-title");var m=$(this).attr("data-subTitle");var p=$(this).parents(".thumbnail");p.find(".goods-tit").find("a").attr("href","/item/"+j);p.find(".img-box").find(".modUrl").attr("href","/item/"+j);p.find(".img-box").find(".goods-handle").find(".event-quickbuy").attr("data-code",j);p.find(".img-box").find(".goods-handle").find(".btn-black-border").attr("href","/item/"+j);p.find(".details-box").find(".goods-handle").find("a").attr("href","/item/"+j);p.find(".details-box").find(".goods-price").find("span").text("¥"+parseInt(k));p.find(".details-box").find(".goods-tit").find("a").text(m);p.find(".details-box").find(".goods-introudce").find("a").text(o);var n=$(this).attr("data-presellLabel");var l=$(this).attr("data-presellItem");var i=$(this).attr("data-itemTagUp");if(l=="true"){var h="";if(n=="PRESELL_WAITING"){h="敬请期待"}else{if(n=="PRESELL_PURCHASE"){h="抢先预订"}else{if(n=="PRESELL_SELL_OUT"){h="售罄"}else{h="预售已结束"}}}$(".presell-button-show",p.find(".img-box")).text(h);$(".presell-mobile-button-show",p.find(".details-box")).text(h);if(n=="PRESELL_SELL_OUT"){$(".tag-hot",p.find(".img-box")).text("售罄")}else{$(".tag-hot",p.find(".img-box")).text("预售")}$(".tag-hot",p.find(".img-box")).removeClass("none")}else{var h="";if(n=="SOLDOUT"){h="暂无库存"}else{h="立即购买"}$(".presell-button-show",p.find(".img-box")).text(h);$(".presell-mobile-button-show",p.find(".details-box")).text(h);if(isNullOrEmpty(i)){$(".tag-hot",p.find(".img-box")).addClass("none")}else{$(".tag-hot",p.find(".img-box")).removeClass("none")}$(".tag-hot",p.find(".img-box")).text(i)}}).hover(function(){$(this).closest(".thumbnail").find(".img-box > a img").attr("src",$(this).data("img-src"))},function(){$(this).closest(".thumbnail").find(".img-box > a img").attr("src",$("span.is-active",g.slides).data("img-src"))})}});$(e).data("spice.swiper",c)}else{c.update()}if(c.isBeginning&&c.isEnd){c.wrapper.addClass("is-disable");c.prevButton.addClass("none");c.nextButton.addClass("none");c.destroy(false,false)}})},priceInit:function(b,a){$.spice.slider(".price-slider",{pauseEvent:true,range:true,min:b,max:a,value:0,tooltip:"hide",values:[b,a],formatter:function(c){if(Array.isArray(c)){$(".price-amount-min").val("¥"+c[0]);$(".price-amount-max").val("¥"+c[1])}}})}},loadType:{append:"append"}};